


        타일 맵


지난시간에는 개별 페이퍼 캐릭터 클래스들에서 관리하던 입력에 대한 코드들을 플레이어 컨트롤러, AI 컨트롤러 클래스르 만들어 여기서 관리하도록 만들었습니다. 
그 과정에서 게임모드도 살짝알아 보기도 했습니다. 

이번 시간에는 맵을 타일 방식으로 변경해보려고합니다. 지금까지는 그냥 배경 이미지를 통째로 띄워서 사용하고 있었는데 이것을 통맵이라고 부르기도 합니다. 
그런데 통맵 말고 타일이라는 작은 단위의 이미지를 찍어내는 방법도 있는데 이것을 실습해보겠습니다. 강의 자료에 있는 tiles.png 파일을 언리얼로 가져오겠습니다. 
컨텐츠 브라우저에서 Maps/Sprite 밑으로 Tilemap 이라는 폴더를 만들고 여기로 드래그 드롭해 가져옵니다. 
지금까지 이미지 리소스를 사용할때 우클릭, 스프라이틍 액션, 페이퍼 2D 텍스쳐 세팅 적용을 하고 나서 Create Sprite를 했었는데 이 타일 이미지는 
지금까지 사용하지 않았던 Create Tile Set 이란걸로 클릭해줍니다.

그러면 tiles_TileSet 이라는 파일이 만들어 지는데 궁금하니까 열어보면 우리가 다운받은 이미지가 열립니다. 그리고 타일 사이즈같은것도 정해줄 수 있는데 
기본 32, 32 사이즈를 그대로 사용하겠습니다. 열린 이미지가 가로로 길쭉한 형태인데 이것을 가로세로 32 픽셀씩을 한 타일이라고 보겠다 라는겁니다. 이렇게 자르면 5타일이 나옵니다. 
이렇게 나뉜 타일 하나씩을 이리저리 사용해서 우리의 맵을 만들겁니다. tiles_TileSet 파일을닫고 또 한가지 만들건데 

우클릭, 페이퍼 2D, 타일맵 이라는 파일을 만듭니다. 이거 말고 타일셋은 방금 만든 tiles_TileSet같은거고 이걸가지고 맵을 만드는게 타일맵입니다. 
이름은 그냥 TileMap 이라고 짓겟습니다. 그리고 TileMap을 열어보겠습니다. 

왼쪽에는 타일세트 선택 툴이 있고 오른쪽에는 회색 화면이 떠 있는데 타일셋에서 타일을 가져와 오른쪽 회색화면에 배치하면 그게 이제 맵이 되는겁니다. 
타일세트 선택툴에서 활성타일세트 옆에 격자무늬 버튼을 누르면 사용할수 있는 타일셋이 나오는데 지금은 방금만든 하나 뿐이지만 나중에 아트 리소스가 많아진다면 
타일을 이것 저것 가져다 맵을 만들 수 있는겁니다. 

tiles_TileSet을 더블클릭하면 아까 tiles_TileSet을 열었을때 같은 화면이 뜹니다. 타일이 화면 중앙에 오도록 조절해줍니다.
이제 이 타일 셋을 가지고 맵을 그릴건데 타일맵의 디테일을 보면 타일 너비, 타일 높이가 다 32로 맞춰져 있는걸 볼수 있습니다. 그리고 맵 너비, 맵 높이가 4씩으로 되있어서 
타일이 4 * 4 로 들어가는 맵을 만들수 있습니다. 이 수치는 마음대로 수정할 수 있습니다. 

예를들어서 가로세로 10 * 10 의 크기로 만들어보겠습니다. 그러면 이게 우리의 맵이 됩니다. 
타일을 어떻게 채울건지는 왼쪽 타일 창의 위쪽에 페인트, 지우개, 채우기 버튼이 있습니다. 이건 그림판만 사용해 봤어도 어떻게 사용할지 아는 것입니다. 
채우기를 누르고 밑의 타일중에 아무거나 하나 선택해 맵을 클릭하면 그 타일로 맵이 꽉차게 됩니다.
페인트를 누르고 맵을 드래그하면 커서 따라서 타일이 깔리기도 합니다. 

이런 느낌의 맵은 어릴때 많이 봤을겁니다. 봄버맨이나, 젤다 2D 같은 게임도 이런 방식입니다. 
물론 지금은 간단하게 테스트하기위해 맵은 10*10 크기이고 타일도 다섯가지 밖에 안되지만 본격적인 게임은 이것보다 훨씬 복잡하집니다. 이런 부분은 사실 아트적인 감각도 필요한 부분입니다.

타일크기를 32 픽셀씩을 정했지만 꼭 이 크기일 필요는 없습니다. 그냥 자신이 정한 규격이 있다면 그것에 맞춘 타일셋이 있어야하는겁니다. 
적당히 맵을 만들어 저장하고 창을 닫겠습니다. 

DevMap 창으로 돌아와 방금 만든 TileMap 파일을 드래그 드롭으로 배치하면 지금가지 사용하던 Sprite 맵과 같이 배치가 됩니다. 
타일맵을 사용하기 위해서 이전에 사용하던 Sprite 맵과 블로킹 블록을 삭제하겠습니다.
타일맵의 Location을 (0,0,0)으로 초기화 하고 이전에 기사와 스켈레톤의 크기를 5로 키웠었으니 맵크기도 5로 키웁니다. 

만들고싶은게임이 만약 이런 레트로 게임이라면 통맵이 아닌 타일로 그린 맵을 사용할 수 있을겁니다. 

꼭 이런 타일맵을 수작업할 필요없이 코드로 자동화 해서 만들 수도 있습니다. 
또 다른 기능으로 타일맵 을 열고 오른쪽에 보면 레이어 리스트라는것이 있습니다. 포토샵을 해본적이 있다면 알 수 있는기능입니다. 
레이어라고 층층히 이미지들을 곂쳐서 관리할 수 있습니다. 

말로만 들어서는 이해가 어려울 수 있습니다.
레이어를 모두 지우고 하나를 새로 만들어 이름을 Wall 로 짓겠습니다. 채우기로 벽타일을 모두 채워줍니다. 새 레이어를 만들어 Ground라고 이름짓고 적당히 바닥이 될 위치에 타일을 그려줍니다. 
이러면 두 레이어가 모두 표현되면서 그냥 맵처럼 보이는데 레이어 하나씩 왼쪽의 눈 표시를 클릭해 눈을 감겨보면 각각 이미지를 따로 관리할 수 있는걸 알 수 있습니다. 
레이어 계층도 위아래로 이동해서 관리할 수 있습니다. 

다음으로 알아볼 만한 것은 타일맵을 열어서 디테일즈를 보면 Separation Per Layer 레이어별 분리 라는 옵션이 있습니다. 말 그대로 여러 레이어들을 관리하고 있는데 말그대로 층이 나뉘어서 관리되고 있는겁니다. 
그러면 레이어별 분리 옵션값을 10을 주고 DevMap으로 돌아가 타일맵을 옆에서 보면 Wall 레이어와 Ground 레이어사이에 틈이 있는게 보일겁니다. 
이걸 잘 활용하게 되면 맨 뒤에는 배경색을 넣고 그 뒤로 지형을 넣고 앞에 나무같은 것들을 넣고 맨 마지막에 땅을 넣는다고하면 레이어 사이에 무언가를 끼워넣는 특수 효과도 사용할 수 있습니다. 

이번에 타일맵의 레이어 깊이 값을 건드리는 김에 이미 고쳣어야할 문제 한가지를 들춰볼겁니다. DevMap에서 스켈레톤의 y 로케이션 값을 한 400정도로 줘서 깊이를 확실이 차이나게 해보겠습니다. 
이상태에서 게임을 시작해보면 상태가 이상하다는걸 알 수 있습니다. 해골이 굉장히 커지고 카메라근처에 오면 시점도 가려집니다. 

지금까지는 일부러 크리쳐 객체들의 y 좌표를 대략적으로 줘서 동일한 깊이에 위치하게 해둬서 티가 안났지만 2D 게임에서는 사실 깊이를 무시하고 똑같은 크리고 보여야 정상일겁니다. 
이것을 어떻게 설정하냐면 BP_Knight 를 열어서 이전에 Spring Arm 이라는 컴포넌트와 거기에 달린 Camera 컴포넌트를 추가 했었습니다. 이 카메라의 디테일을 보면 
Projection Mode 투영모드 라는 옵션이 있습니다. Perspective 라는 것과 Orthographic 이라는 것이 있습니다.
이중에 Perspective는 3D 게임을 만들때 사용하는 시점입니다. 평범하게 3차원 세계를 보는 시점입니다. 그런데 Orthographic이라는것은 깊이와는 상관없이 같은 크기로 보여지게 되는 시점입니다. 
카메라에 찍힌 모든 사물들을 일정거리로 압축해서 보는 것과 같습니다. 

그래서 카메라의 시점을 Orthographic으로 바꾸고 실행해보면 이번에는 모든 물체들이 너무 커져 보인다는 기 문제입니다. 왜냐면 Perspective 시점에서는 크기를 맞춰줘야해서 Scale값들을 건드렸기 때문입니다. 
그렇다고 해서 이미 만들었던 모든 물체의 Scale을 다 바꾸기 보다는 카메라에서 보이는 크기를 바꾸는게 더 빠른데 아까 봤던 카메라 컴포넌트의 디테일을보면 Ortho Width 라는게 있습니다. 
이게 카메라를 얼마만큼 유닛을 표현해줄것인지에 대한 옵션입니다. 대강 2048 정도로 값을 주고 테스트 해보면 적당히 잘 보인다는걸 알 수 있습니다. 